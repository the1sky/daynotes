#### 树莓派3实战

1、安装系统


    #1  准备一张micro sd卡,注意最新的pi3是这个格式
    #2  格式化，FAT格式（支持大容量）
    #3  下载官方NOODS，直接copy到sd卡
    #4  把sd卡插入pi3,同时接显示器，鼠标以及键盘
    #5  供电启动，安装系统


2、连接pi3

    #1  用直连网线连接电脑和pi3
    #2  网络共享，选择网线连接的网卡，( mac os下我使用usb转换,选择“usb以太网” )
    #3  ssh pi@192.168.2.2，并输入密码raspberry

3、手动连接wifi

    #1  启动网卡

            ifconfig wlan0  up

    #2  连接wifi,通过直连的方式没有成功,需要继续跟进   ???

            iwconfig wlan0 essid xxx key s:xxxxx

        通过修改配置文件成功

            vim /etc/network/interfaces

            添加:

            iface wlan0 inet dhcp
            wpa-ssid “xxxxx"````
            wpa-psk “xxxxx"

    #3  重启网卡,修改配置文件后需要

            /etc/init.d/networking restart

4、DNS配置

    #1 成功连接wifi后发现能通过ip访问当不能通过域名访问,第一时间想到DNS,配置如下:

        echo "nameserver 8.8.8.8" > /etc/resolv.conf

    #2 resolv.conf文件在从新连接wifi后,会被重置为:

        # Generated by resolvconf
        nameserver 192.168.2.1  #共享网卡的地址
        nameserver 172.20.10.1  #wlan0的连接到手机热点的地址

        待研究!!!

5、切换到用户pi时,ping报错

    #1 错误如下:
        ping: icmp open socket: Operation not permitted

    #2 解决:
        sudo chmod u+s /bin/ping

6、变更时区

    #1  图形化方式:
            sudo dpkg-reconfigure tzdata
    #2  直接copy:
            sudo cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime

7、pi共享电脑网络

    macbook系统:

        系统偏好  ->  共享  ->  互联网共享(共享以下来源的连接:WIFI,  用以下端口共享给电脑:USB以太网)

8、WIFI AP

    #1  检测是否支持
            iw list
            结果:
            Supported interface modes:
                     * IBSS
                     * managed
                     * AP
                     * P2P-client
                     * P2P-GO
                     * P2P-device
            注意AP,即为支持,说明pi3是支持的

    #1  建立AP
        *   安装hostapd
                sudo apt-get install hostapd
        *   编辑默认启动文件
                vim /etc/default/hostapd

                编写:
                DAEMON_CONF="/etc/hostapd/hostapd.conf"
        *   配置hostapd
                vim /etc/hostapd/hostapd.conf

                注意, 没有的话创建该文件

                配置样例如下:
                    interface=wlan0
                    driver=nl80211
                    ssid=test
                    hw_mode=g
                    channel=1
                    macaddr_acl=0
                    auth_algs=1
                    ignore_broadcast_ssid=0
                    wpa=3
                    wpa_passphrase=1234567890
                    wpa_key_mgmt=WPA-PSK
                    wpa_pairwise=TKIP
                    rsn_pairwise=CCMP

        *   hostapd控制命令:
            sudo service dnsmasq start

        *   为连接到AP的客户端分配静态IP
                sudo vim /etc/dhcpcd.conf
                在最后一行添加:
                    interface wlan0
                        static ip_address=172.24.1.1/24


        *   安装dnsmasq
                sudo apt-get install dnsmasq

        *   配置dnsmasp
                interface=wlan0
                bind-interfaces
                server=8.8.8.8
                domain-needed
                bogus-priv
                dhcp-range=172.24.1.50,172.24.1.150,12h

        *   dnsmasp控制命令:
                sudo service dnsmasq start

        *   配置IPV4 FORWARDING

                sudo vim /etc/sysctl.conf

                #net.ipv4.ip_forward=1  这行改为:
                net.ipv4.ip_forward=1

        *   AP的网络分享etho配置

                配置如下:

                sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
                sudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT
                sudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT

                每次启动设置:
                sudo sh -c "iptables-save > /etc/iptables.ipv4.nat"

                使dhcpd运行:
                    创建文件:
                        sudo vim /lib/dhcpcd/dhcpcd-hooks/70-ipv4-nat
                    写入内容:
                        iptables-restore < /etc/iptables.ipv4.nat

        *   启用

                sudo service hostapd start
                sudo service dnsmasq start

                或者

                sudo reboot

        *   推荐文章:
            http://askubuntu.com/questions/180733/how-to-setup-an-access-point-mode-wi-fi-hotspot
            http://www.cyberciti.biz/faq/debian-ubuntu-linux-setting-wireless-access-point/
            https://frillip.com/using-your-raspberry-pi-3-as-a-wifi-access-point-with-hostapd/

9、aircrack-ng,reaver

10、切换到国内源

